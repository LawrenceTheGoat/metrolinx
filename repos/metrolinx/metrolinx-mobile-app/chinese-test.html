<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese Speech Test - ä¸­æ–‡è¯­éŸ³æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            width: 100%;
            transition: all 0.3s;
        }
        .test-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        .test-button.recording {
            background: #f44336;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
        h1 { text-align: center; }
        .instructions {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ Chinese Speech Test</h1>
        <h2 style="text-align: center;">ä¸­æ–‡è¯­éŸ³æµ‹è¯•</h2>
        
        <div class="instructions">
            <h3>Instructions / è¯´æ˜:</h3>
            <p><strong>English:</strong> Click the button below and say "è”åˆç«™åˆ°é‡‘èºç«™" (Union Station to Oriole Station) in Chinese. The app will use English speech recognition but detect Chinese phonetic patterns.</p>
            <p><strong>ä¸­æ–‡:</strong> ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼Œè¯´"è”åˆç«™åˆ°é‡‘èºç«™"ã€‚åº”ç”¨ç¨‹åºå°†ä½¿ç”¨è‹±æ–‡è¯­éŸ³è¯†åˆ«ï¼Œä½†ä¼šæ£€æµ‹ä¸­æ–‡è¯­éŸ³æ¨¡å¼ã€‚</p>
        </div>

        <button class="test-button" id="test-btn" onclick="testChineseDetection()">
            ğŸ¤ Test Chinese Speech / æµ‹è¯•ä¸­æ–‡è¯­éŸ³
        </button>
        
        <div class="result" id="result"></div>
        
        <div class="instructions">
            <h3>What to expect / é¢„æœŸç»“æœ:</h3>
            <ul>
                <li>The browser will capture your Chinese speech using English recognition</li>
                <li>You might see phonetic approximations like "leon her john dow gin ying john"</li>
                <li>The app should detect this as Chinese and respond appropriately</li>
                <li>æµè§ˆå™¨å°†ä½¿ç”¨è‹±æ–‡è¯†åˆ«æ•è·æ‚¨çš„ä¸­æ–‡è¯­éŸ³</li>
                <li>æ‚¨å¯èƒ½ä¼šçœ‹åˆ°è¯­éŸ³è¿‘ä¼¼ï¼Œå¦‚"leon her john dow gin ying john"</li>
                <li>åº”ç”¨ç¨‹åºåº”è¯¥æ£€æµ‹åˆ°è¿™æ˜¯ä¸­æ–‡å¹¶åšå‡ºé€‚å½“å“åº”</li>
            </ul>
        </div>
    </div>

    <script src="speech-handler.js"></script>
    <script>
        let speechHandler = null;
        let isListening = false;

        // Initialize speech handler
        try {
            speechHandler = new SpeechHandler();
            log('Speech handler initialized successfully', 'success');
        } catch (error) {
            log('Failed to initialize speech handler: ' + error.message, 'error');
        }

        function log(message, type = 'info') {
            const result = document.getElementById('result');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type;
            result.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            result.scrollTop = result.scrollHeight;
        }

        async function testChineseDetection() {
            const button = document.getElementById('test-btn');
            
            if (isListening) {
                // Stop listening
                try {
                    await speechHandler.stopListening();
                    button.textContent = 'ğŸ¤ Test Chinese Speech / æµ‹è¯•ä¸­æ–‡è¯­éŸ³';
                    button.classList.remove('recording');
                    isListening = false;
                    log('Stopped listening', 'info');
                } catch (error) {
                    log('Error stopping: ' + error.message, 'error');
                }
                return;
            }

            // Start listening
            try {
                button.textContent = 'ğŸ”´ Stop / åœæ­¢';
                button.classList.add('recording');
                isListening = true;
                
                log('Starting Chinese speech test...', 'info');
                log('Please say: "è”åˆç«™åˆ°é‡‘èºç«™"', 'info');
                
                const result = await speechHandler.startListening();
                
                if (result && result.transcript) {
                    log(`Raw transcript: "${result.transcript}"`, 'info');
                    log(`Detected language: ${result.language}`, result.language === 'zh' ? 'success' : 'warning');
                    log(`Confidence: ${result.confidence}`, 'info');
                    
                    if (result.language === 'zh') {
                        log('ğŸ‰ SUCCESS: Chinese detected!', 'success');
                        log('The phonetic pattern recognition is working!', 'success');
                    } else {
                        log('âš ï¸ Chinese not detected, but transcript captured', 'warning');
                        log('This might still work for transit queries', 'info');
                    }
                } else {
                    log('No speech detected', 'warning');
                    log('Try speaking louder or closer to the microphone', 'info');
                }
                
            } catch (error) {
                log('Error: ' + error.message, 'error');
            } finally {
                button.textContent = 'ğŸ¤ Test Chinese Speech / æµ‹è¯•ä¸­æ–‡è¯­éŸ³';
                button.classList.remove('recording');
                isListening = false;
            }
        }

        // Test the detection patterns directly
        function testPatterns() {
            log('Testing Chinese phonetic patterns...', 'info');
            
            const testPhrases = [
                'leon her john dow gin ying john',
                'leon hope john to gin yang john',
                'lean heart zone to jean young zone',
                'line hub station to gene ying station',
                'lynn home john dow gym yang john',
                'union station to oriole station',
                'è”åˆç«™åˆ°é‡‘èºç«™'
            ];
            
            testPhrases.forEach(phrase => {
                const detectedLang = speechHandler.detectLanguage(phrase);
                log(`"${phrase}" â†’ ${detectedLang}`, detectedLang === 'zh' ? 'success' : 'info');
            });
        }

        // Auto-test patterns on load
        window.addEventListener('load', () => {
            setTimeout(testPatterns, 1000);
        });
    </script>
</body>
</html>
